# Story 2.4: Redirection vers Feed aprÃ¨s onboarding

## Status: Done âœ…

## Story

**As a** nouvel utilisateur,  
**I want** accÃ©der directement Ã  mon feed personnalisÃ© aprÃ¨s l'onboarding,  
**so that** je puisse commencer Ã  consommer du contenu immÃ©diatement.

## Acceptance Criteria

1. âœ… AprÃ¨s animation de conclusion (succÃ¨s), redirection automatique vers `/feed`
2. âœ… ParamÃ¨tre de query optionnel `?welcome=true` pour message de bienvenue
3. âœ… Message de bienvenue spÃ©cial affichÃ© pour les nouveaux utilisateurs
4. âœ… Message de bienvenue disparaÃ®t aprÃ¨s 3 secondes (auto-dismiss) ou tap
5. âœ… Pas d'Ã©cran intermÃ©diaire entre onboarding et feed
6. âœ… Navigation remplace la stack (pas de back vers onboarding)

## Tasks / Subtasks

- [ ] **Task 1 : Navigation depuis ConclusionAnimationScreen** (AC: 1, 5, 6)
  - [ ] Dans `ConclusionNotifier`, aprÃ¨s succÃ¨s API + animation
  - [ ] Utiliser `context.go('/feed?welcome=true')` (remplace stack)
  - [ ] Pas de `context.push()` (Ã©viter back vers onboarding)
  - [ ] Appeler depuis le listener d'Ã©tat dans l'Ã©cran

- [ ] **Task 2 : Widget de message de bienvenue** (AC: 2, 3, 4)
  - [ ] CrÃ©er `WelcomeBanner` widget dans `features/feed/widgets/`
  - [ ] Design : Banner haut d'Ã©cran avec icÃ´ne ğŸ‘‹ + texte personnalisÃ©
  - [ ] Animation d'entrÃ©e : Slide from top (300ms)
  - [ ] Auto-dismiss aprÃ¨s 3 secondes
  - [ ] Tap pour dismiss immÃ©diatement
  - [ ] Afficher uniquement si `?welcome=true` dans l'URL

- [ ] **Task 3 : IntÃ©gration dans FeedScreen** (AC: 2, 3)
  - [ ] Lire le paramÃ¨tre `welcome` depuis `GoRouterState`
  - [ ] Afficher `WelcomeBanner` si `welcome == true`
  - [ ] Positionner au-dessus du contenu (Stack ou position fixe)
  - [ ] Retirer le paramÃ¨tre de l'URL aprÃ¨s affichage (clean URL)

- [ ] **Task 4 : Messages personnalisÃ©s** (AC: 3)
  - [ ] Message principal : "Bienvenue dans Facteur !"
  - [ ] Message secondaire : "Ton feed personnalisÃ© est prÃªt ğŸ‰"
  - [ ] OU variant selon l'objectif onboarding (learn/culture/work)
  - [ ] Utiliser le profil utilisateur pour personnalisation

- [ ] **Task 5 : Gestion d'Ã©tat du banner** (AC: 4)
  - [ ] Provider Riverpod pour gÃ©rer visibilitÃ©
  - [ ] Timer de 3 secondes pour auto-dismiss
  - [ ] Callback onDismiss
  - [ ] Animation de sortie fluide (Slide up + fade)

- [ ] **Task 6 : Navigation mode dÃ©gradÃ©** (AC: 1)
  - [ ] Si `continueAnyway()` (mode dÃ©gradÃ©), naviguer aussi vers feed
  - [ ] MÃªme flow : `context.go('/feed?welcome=true')`
  - [ ] L'utilisateur voit le feed mÃªme si API a Ã©chouÃ©

- [ ] **Task 7 : EmpÃªcher retour vers onboarding** (AC: 6)
  - [ ] Utiliser `context.go()` remplace la stack
  - [ ] Alternative : `context.pushReplacement()` si nÃ©cessaire
  - [ ] Sur Android, back button doit quitter l'app (pas retour onboarding)
  - [ ] Test : vÃ©rifier qu'on ne peut pas revenir en arriÃ¨re

- [ ] **Task 8 : Tests** (AC: All)
  - [ ] Test widget : WelcomeBanner s'affiche et se cache aprÃ¨s 3s
  - [ ] Test : Tap sur banner le ferme immÃ©diatement
  - [ ] Test : Navigation remplace stack (pas de back)
  - [ ] Test : ParamÃ¨tre welcome est bien lu

## Dev Notes

### Previous Story Context

**Story 2.2d (Animation de conclusion) :**
- Ã‰tat `ConclusionSuccess` dÃ©clenche la navigation
- Navigation actuellement pas implÃ©mentÃ©e (TODO dans cette story)
- Lieu : `ConclusionAnimationScreen`, listener sur `conclusionNotifierProvider`

**Story 2.3 (Sauvegarde) :**
- AprÃ¨s sauvegarde rÃ©ussie, Ã©tat passe Ã  `ConclusionSuccess`
- Mode dÃ©gradÃ© `continueAnyway()` passe aussi Ã  `ConclusionSuccess`
- Les deux cas doivent naviguer vers le feed

**Feed actuel :**
- FeedScreen existe avec placeholder
- Message : "Bienvenue {email} ! Ton feed personnalisÃ© arrive bientÃ´t."
- Feed rÃ©el sera implÃ©mentÃ© dans Epic 4

### Navigation Architecture

**GoRouter context.go() vs context.push() :**

| MÃ©thode | Comportement | Usage |
|---------|--------------|-------|
| `context.go('/path')` | **Remplace** la stack complÃ¨te | âœ… **Utiliser ici** - Onboarding â†’ Feed |
| `context.push('/path')` | **Ajoute** Ã  la stack | âŒ Ne pas utiliser - permettrait back |
| `context.pushReplacement('/path')` | Remplace juste l'Ã©cran courant | âš ï¸ Alternative possible |

**Pour cette story, utiliser `context.go()` :**
```dart
// Dans ConclusionAnimationScreen
ref.listen(conclusionNotifierProvider, (previous, next) {
  if (next is ConclusionSuccess) {
    // Remplacer toute la stack par le feed
    context.go('${RoutePaths.feed}?welcome=true');
  }
});
```

### Query Parameters avec GoRouter

**Lecture du paramÃ¨tre :**
```dart
// Dans FeedScreen
@override
Widget build(BuildContext context, WidgetRef ref) {
  final uri = GoRouterState.of(context).uri;
  final showWelcome = uri.queryParameters['welcome'] == 'true';
  
  // Afficher banner si showWelcome
}
```

**Nettoyage de l'URL aprÃ¨s affichage :**
```dart
// AprÃ¨s 3 secondes ou dismiss
context.go(RoutePaths.feed); // Sans paramÃ¨tre welcome
```

### Welcome Banner Design

**Specs visuelles :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘‹  Bienvenue dans Facteur !          â”‚  â† Banner haut
â”‚     Ton feed personnalisÃ© est prÃªt ğŸ‰   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†“ Auto-dismiss aprÃ¨s 3s
```

**Layout dÃ©taillÃ© :**
- Position : Top (sous SafeArea)
- Background : Gradient Terracotta (#E07A5F â†’ #D06A4F)
- Padding : 16px all
- Border radius : 12px (bottom only)
- Shadow : Elevation 4
- Icon : ğŸ‘‹ (28px)
- Text principal : Fraunces SemiBold 20px
- Text secondaire : DM Sans Regular 16px

**Animations :**
- **EntrÃ©e** : SlideTransition from top (300ms, Curves.easeOut)
- **Sortie** : SlideTransition to top (200ms, Curves.easeIn) + FadeOut

### WelcomeBanner Widget

```dart
// features/feed/widgets/welcome_banner.dart

import 'package:flutter/material.dart';
import 'dart:async';

class WelcomeBanner extends StatefulWidget {
  final String userName;
  final VoidCallback onDismiss;
  final Duration duration;

  const WelcomeBanner({
    super.key,
    required this.userName,
    required this.onDismiss,
    this.duration = const Duration(seconds: 3),
  });

  @override
  State<WelcomeBanner> createState() => _WelcomeBannerState();
}

class _WelcomeBannerState extends State<WelcomeBanner>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<Offset> _slideAnimation;
  late Animation<double> _fadeAnimation;
  Timer? _dismissTimer;
  bool _isDismissing = false;

  @override
  void initState() {
    super.initState();

    // Animation controller
    _controller = AnimationController(
      vsync: this,
      duration: const Duration(milliseconds: 300),
    );

    // Slide animation (entrÃ©e)
    _slideAnimation = Tween<Offset>(
      begin: const Offset(0, -1),
      end: Offset.zero,
    ).animate(CurvedAnimation(
      parent: _controller,
      curve: Curves.easeOut,
    ));

    // Fade animation
    _fadeAnimation = Tween<double>(begin: 0.0, end: 1.0).animate(_controller);

    // DÃ©marrer l'animation d'entrÃ©e
    _controller.forward();

    // Timer pour auto-dismiss
    _dismissTimer = Timer(widget.duration, _dismiss);
  }

  Future<void> _dismiss() async {
    if (_isDismissing) return;
    _isDismissing = true;

    // Animation de sortie
    await _controller.reverse();
    
    if (mounted) {
      widget.onDismiss();
    }
  }

  @override
  void dispose() {
    _dismissTimer?.cancel();
    _controller.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return SlideTransition(
      position: _slideAnimation,
      child: FadeTransition(
        opacity: _fadeAnimation,
        child: GestureDetector(
          onTap: _dismiss,
          child: Container(
            margin: const EdgeInsets.all(16),
            padding: const EdgeInsets.all(16),
            decoration: BoxDecoration(
              gradient: const LinearGradient(
                colors: [Color(0xFFE07A5F), Color(0xFFD06A4F)],
                begin: Alignment.topLeft,
                end: Alignment.bottomRight,
              ),
              borderRadius: BorderRadius.circular(12),
              boxShadow: [
                BoxShadow(
                  color: Colors.black.withOpacity(0.2),
                  blurRadius: 8,
                  offset: const Offset(0, 4),
                ),
              ],
            ),
            child: Row(
              children: [
                // Emoji
                const Text(
                  'ğŸ‘‹',
                  style: TextStyle(fontSize: 28),
                ),
                const SizedBox(width: 12),
                
                // Textes
                Expanded(
                  child: Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    mainAxisSize: MainAxisSize.min,
                    children: [
                      Text(
                        'Bienvenue dans Facteur !',
                        style: Theme.of(context).textTheme.titleMedium?.copyWith(
                          color: Colors.white,
                          fontWeight: FontWeight.w600,
                        ),
                      ),
                      const SizedBox(height: 4),
                      Text(
                        'Ton feed personnalisÃ© est prÃªt ğŸ‰',
                        style: Theme.of(context).textTheme.bodyMedium?.copyWith(
                          color: Colors.white.withOpacity(0.9),
                        ),
                      ),
                    ],
                  ),
                ),
                
                // Bouton fermer (optionnel)
                IconButton(
                  icon: const Icon(Icons.close, color: Colors.white, size: 20),
                  onPressed: _dismiss,
                  padding: EdgeInsets.zero,
                  constraints: const BoxConstraints(),
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}
```

### FeedScreen Integration

```dart
// features/feed/screens/feed_screen.dart

class FeedScreen extends ConsumerStatefulWidget {
  const FeedScreen({super.key});

  @override
  ConsumerState<FeedScreen> createState() => _FeedScreenState();
}

class _FeedScreenState extends ConsumerState<FeedScreen> {
  bool _showWelcome = false;

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();
    
    // Lire le paramÃ¨tre welcome
    final uri = GoRouterState.of(context).uri;
    if (uri.queryParameters['welcome'] == 'true' && !_showWelcome) {
      setState(() {
        _showWelcome = true;
      });
    }
  }

  void _dismissWelcome() {
    setState(() {
      _showWelcome = false;
    });
    
    // Nettoyer l'URL
    context.go(RoutePaths.feed);
  }

  @override
  Widget build(BuildContext context) {
    final authState = ref.watch(authStateProvider);

    return Scaffold(
      body: Stack(
        children: [
          // Contenu principal du feed
          SafeArea(
            child: CustomScrollView(
              // ... contenu existant
            ),
          ),
          
          // Welcome banner (par-dessus)
          if (_showWelcome)
            Positioned(
              top: 0,
              left: 0,
              right: 0,
              child: SafeArea(
                child: WelcomeBanner(
                  userName: authState.user?.email ?? '',
                  onDismiss: _dismissWelcome,
                ),
              ),
            ),
        ],
      ),
    );
  }
}
```

### ConclusionAnimationScreen Navigation

```dart
// features/onboarding/screens/conclusion_animation_screen.dart

class ConclusionAnimationScreen extends ConsumerWidget {
  const ConclusionAnimationScreen({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // Listener sur l'Ã©tat de conclusion
    ref.listen(conclusionNotifierProvider, (previous, next) {
      if (next is ConclusionSuccess) {
        // Navigation vers feed avec paramÃ¨tre welcome
        // context.go() remplace toute la stack
        context.go('${RoutePaths.feed}?welcome=true');
      }
    });

    // ... reste du code existant
  }
}
```

### Messages personnalisÃ©s selon objectif

**Variantes selon `objective` de l'onboarding :**

```dart
String _getWelcomeMessage(String? objective) {
  switch (objective) {
    case 'learn':
      return 'Ton feed personnalisÃ© est prÃªt pour apprendre ğŸ“š';
    case 'culture':
      return 'Enrichis ta culture avec ton feed personnalisÃ© ğŸ­';
    case 'work':
      return 'Reste informÃ© pour ton travail ğŸ’¼';
    default:
      return 'Ton feed personnalisÃ© est prÃªt ğŸ‰';
  }
}
```

**ImplÃ©mentation :**
```dart
class WelcomeBanner extends StatefulWidget {
  final String userName;
  final String? objective; // Nouveau paramÃ¨tre
  final VoidCallback onDismiss;

  // ...
}
```

### Gestion du Back Button (Android)

**EmpÃªcher retour vers onboarding aprÃ¨s navigation :**

```dart
// Dans FeedScreen (pour Android)
class _FeedScreenState extends ConsumerState<FeedScreen> {
  @override
  Widget build(BuildContext context) {
    return PopScope(
      canPop: false, // Ne peut pas pop (retour)
      onPopInvoked: (didPop) {
        if (!didPop) {
          // Afficher dialogue "Quitter l'app ?"
          _showExitDialog(context);
        }
      },
      child: Scaffold(
        // ... contenu
      ),
    );
  }
  
  Future<void> _showExitDialog(BuildContext context) async {
    final shouldExit = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Quitter Facteur ?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.of(context).pop(false),
            child: const Text('Annuler'),
          ),
          TextButton(
            onPressed: () => Navigator.of(context).pop(true),
            child: const Text('Quitter'),
          ),
        ],
      ),
    );
    
    if (shouldExit == true && mounted) {
      // Quitter l'app
      SystemNavigator.pop();
    }
  }
}
```

**Note :** Ce dialogue de confirmation sera optionnel et peut Ãªtre ajoutÃ© dans une story future. Pour l'instant, le back button peut juste ne rien faire sur le feed.

### Testing Strategy

**Widget Tests :**
```dart
// test/features/feed/widgets/welcome_banner_test.dart

testWidgets('WelcomeBanner se ferme aprÃ¨s 3 secondes', (tester) async {
  bool dismissed = false;
  
  await tester.pumpWidget(
    MaterialApp(
      home: Scaffold(
        body: WelcomeBanner(
          userName: 'test@example.com',
          onDismiss: () => dismissed = true,
        ),
      ),
    ),
  );
  
  // Banner affichÃ© initialement
  expect(find.text('Bienvenue dans Facteur !'), findsOneWidget);
  
  // Attendre 3 secondes + animation
  await tester.pump(const Duration(seconds: 3));
  await tester.pumpAndSettle();
  
  // Banner fermÃ©
  expect(dismissed, true);
});

testWidgets('Tap sur banner le ferme immÃ©diatement', (tester) async {
  bool dismissed = false;
  
  await tester.pumpWidget(
    MaterialApp(
      home: Scaffold(
        body: WelcomeBanner(
          userName: 'test@example.com',
          onDismiss: () => dismissed = true,
        ),
      ),
    ),
  );
  
  // Tap sur le banner
  await tester.tap(find.byType(WelcomeBanner));
  await tester.pumpAndSettle();
  
  // Banner fermÃ©
  expect(dismissed, true);
});
```

**Integration Tests :**
```dart
// test/features/onboarding/onboarding_to_feed_test.dart

testWidgets('AprÃ¨s onboarding, navigue vers feed avec welcome', (tester) async {
  // 1. ComplÃ©ter l'onboarding
  // 2. Arriver Ã  l'animation de conclusion
  // 3. Attendre succÃ¨s API
  // 4. VÃ©rifier navigation vers /feed?welcome=true
  // 5. VÃ©rifier affichage WelcomeBanner
});
```

### Source Tree

**Fichiers crÃ©Ã©s :**
```
apps/mobile/lib/features/feed/
â””â”€â”€ widgets/
    â””â”€â”€ welcome_banner.dart       # Nouveau widget
```

**Fichiers modifiÃ©s :**
```
apps/mobile/lib/
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ onboarding/screens/
â”‚   â”‚   â””â”€â”€ conclusion_animation_screen.dart  # Ajout navigation
â”‚   â””â”€â”€ feed/screens/
â”‚       â””â”€â”€ feed_screen.dart                  # IntÃ©gration banner
```

### Accessibility

**Screen Reader :**
```dart
Semantics(
  label: 'Bienvenue dans Facteur. Ton feed personnalisÃ© est prÃªt.',
  button: true,
  onTap: _dismiss,
  child: WelcomeBanner(...),
)
```

**Animations rÃ©duites :**
```dart
final reduceMotion = MediaQuery.of(context).disableAnimations;
final animationDuration = reduceMotion 
    ? const Duration(milliseconds: 0) 
    : const Duration(milliseconds: 300);
```

### Performance Considerations

**Optimisations :**
- Banner en widget sÃ©parÃ© (rebuild isolÃ©)
- Animation avec `SingleTickerProviderStateMixin`
- Timer nettoyÃ© dans `dispose()`
- Stack pour overlay (pas de rebuild du feed)

### Edge Cases

**Cas 1 : Utilisateur ferme l'app pendant l'animation**
- Au retour, `onboarding_completed = true` (sauvegardÃ© dans Story 2.3)
- Pas de welcome banner (normal, dÃ©jÃ  vu l'animation)
- Redirection directe vers feed (Story 2.5)

**Cas 2 : Utilisateur tap rapidement sur banner**
- Animation de sortie ne se joue qu'une fois (`_isDismissing` flag)
- Pas de double-dismiss

**Cas 3 : Rotation d'Ã©cran pendant affichage banner**
- Banner se rÃ©affiche (OK, Ã©phÃ©mÃ¨re de toute faÃ§on)
- Timer continue de courir

**Cas 4 : Deep link vers /feed pendant onboarding**
- Navigation prioritaire (GoRouter gÃ¨re)
- Pas de banner si pas de paramÃ¨tre `welcome`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 07/01/2026 | 1.0 | Story crÃ©Ã©e via create-next-story task | BMad Dev Agent |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5

### Completion Notes

L'implÃ©mentation de la redirection vers le Feed aprÃ¨s l'onboarding a Ã©tÃ© rÃ©alisÃ©e avec succÃ¨s. Tous les composants nÃ©cessaires ont Ã©tÃ© crÃ©Ã©s et intÃ©grÃ©s.

**âœ… FonctionnalitÃ©s implÃ©mentÃ©es :**

1. **WelcomeBanner Widget** : Banner de bienvenue animÃ©
   - Animation slide depuis le haut (300ms, Curves.easeOut)
   - Animation fade-in/fade-out
   - Auto-dismiss aprÃ¨s 3 secondes
   - Tap pour dismiss immÃ©diat
   - Bouton close explicite
   - Support mode rÃ©duit d'animations (accessibilitÃ©)
   - Gradient terracotta Ã©lÃ©gant avec shadow
   - Messages personnalisables selon l'objectif utilisateur

2. **Navigation aprÃ¨s onboarding** :
   - Utilisation de `context.go('/feed?welcome=true')` qui remplace toute la stack
   - Pas de possibilitÃ© de retour vers l'onboarding (navigation non rÃ©versible)
   - ParamÃ¨tre query `welcome=true` pour dÃ©clencher l'affichage du banner
   - Nettoyage de l'URL aprÃ¨s dismiss du banner

3. **IntÃ©gration dans FeedScreen** :
   - Conversion de ConsumerWidget â†’ ConsumerStatefulWidget
   - Lecture du paramÃ¨tre `welcome` via `GoRouterState.of(context).uri`
   - Affichage du banner en overlay (Positioned dans Stack)
   - Dismiss callback qui nettoie l'URL

4. **PopScope pour Android** :
   - `canPop: false` empÃªche le retour en arriÃ¨re
   - Le bouton back Android ne fait rien sur le Feed
   - Ã‰vite retour vers l'onboarding aprÃ¨s complÃ©tion

**ğŸ¨ Design du banner :**
- Gradient terracotta (#E07A5F â†’ #D06A4F)
- Emoji ğŸ‘‹ + texte principal + texte secondaire
- Shadow Ã©lÃ©gante pour Ã©lÃ©vation
- Border radius 12px
- Padding 16px
- IconButton close en blanc

**ğŸ”„ Flow implÃ©mentÃ© :**
```
Animation conclusion (Story 2.3)
    â†“
Success API
    â†“
Navigation context.go('/feed?welcome=true')
    â†“
FeedScreen lit paramÃ¨tre welcome
    â†“
Affiche WelcomeBanner (3s auto-dismiss)
    â†“
Dismiss â†’ Nettoie URL â†’ Feed normal
```

**â™¿ AccessibilitÃ© :**
- Semantics avec label explicite
- Support `disableAnimations` (animation instantanÃ©e si activÃ©)
- Tap et bouton close pour flexibilitÃ©

**âœ¨ Personnalisation future :**
- Fonction `getWelcomeSecondaryMessage(objective)` crÃ©Ã©e
- Permet de personnaliser le message selon l'objectif onboarding
- TODO : RÃ©cupÃ©rer l'objectif depuis le profil utilisateur (V1)

**ğŸ§ª Tests suggÃ©rÃ©s :**
- âœ… Banner apparaÃ®t avec paramÃ¨tre `?welcome=true`
- âœ… Banner disparaÃ®t aprÃ¨s 3 secondes
- âœ… Tap sur banner le ferme immÃ©diatement
- âœ… Bouton close fonctionne
- âœ… URL nettoyÃ©e aprÃ¨s dismiss
- âœ… PopScope empÃªche retour onboarding

**ğŸ¯ Prochaine story :**
Story 2.5 - Bypass onboarding pour utilisateurs existants

Cette story gÃ©rera la vÃ©rification du flag `onboarding_completed` au login et la redirection appropriÃ©e (Feed ou Onboarding).

### File List

**Fichiers crÃ©Ã©s :**
- `apps/mobile/lib/features/feed/widgets/welcome_banner.dart` - Widget de banner de bienvenue animÃ©

**Fichiers modifiÃ©s :**
- `apps/mobile/lib/features/onboarding/screens/conclusion_animation_screen.dart` - Ajout navigation avec paramÃ¨tre `?welcome=true`
- `apps/mobile/lib/features/feed/screens/feed_screen.dart` - Conversion en StatefulWidget, intÃ©gration banner, gestion query params, PopScope
