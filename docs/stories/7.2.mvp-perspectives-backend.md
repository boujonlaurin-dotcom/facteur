# Story 7.2: MVP Perspectives - API & Backend

## Status
Done

## Story
**As a** utilisateur,
**I want** voir des points de vue alternatifs sur un article,
**so that** je puisse me forger une opinion plus nuancée.

## Acceptance Criteria
1. ✅ Endpoint `GET /contents/{id}/perspectives` fonctionnel.
2. ✅ Extraction de mots-clés significatifs du titre (noms propres prioritaires).
3. ✅ Recherche Google News RSS avec les mots-clés.
4. ✅ Mapping de biais pour ~50 sources françaises majeures.
5. ✅ Filtrage automatique de l'article source (exclusion par URL et titre).
6. ✅ Retourne jusqu'à 10 perspectives par défaut (anciennement 5).
7. ✅ Latence < 1s pour la recherche.

## Tasks / Subtasks
- [x] PerspectiveService (AC: 2, 3, 4)
  - [x] Create `perspective_service.py`
  - [x] Implement `extract_keywords()` with proper noun prioritization
  - [x] Implement `search_perspectives()` via Google News RSS
  - [x] Create `DOMAIN_BIAS_MAP` for ~50 French sources
- [x] API Endpoint (AC: 1)
  - [x] Add `GET /contents/{id}/perspectives` to `contents.py`
  - [x] Return perspectives with bias_distribution
- [x] Performance Validation (AC: 5)
  - [x] Test latency (result: ~400ms average)

## Dev Notes
- **Pivot**: Approche initiale (clustering interne) abandonnée au profit de Google News live search
- **Raison**: Taux de clustering interne trop faible (~20%) avec sources spécialisées
- **Mapping biais corrigés** suite au feedback utilisateur:
  - CNEWS: center → far-right
  - BFM TV: center → right
  - Marianne: right → center-left

### Source Tree
```
packages/api/app/services/perspective_service.py  [NEW]
packages/api/app/routers/contents.py              [MODIFIED]
```

## Testing
- [x] Unit: Keyword extraction extracts proper nouns (Powell, Trump, Macron)
- [x] Integration: Google News RSS returns 5+ perspectives
- [x] E2E: API endpoint returns structured response with bias_distribution

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 12/01/2026 | 1.0 | Création initiale (approach clustering) | BMad Method |
| 12/01/2026 | 2.0 | Pivot vers Google News live search | Dev Agent |
| 12/01/2026 | 2.1 | Fix keyword extraction (proper nouns) | Dev Agent |
| 12/01/2026 | 2.2 | Fix bias mapping (CNEWS, BFM, Marianne) | Dev Agent |

## Dev Agent Record

### Agent Model Used
Antigravity (Google Deepmind)

### Completion Notes List
- Initial clustering approach yielded only 10-20% coverage
- Pivoted to live Google News RSS search (0 infrastructure, ~400ms latency)
- Keyword extraction improved to prioritize capitalized words (names)
- Bias mapping includes left/center-left/center/center-right/right/far-right

### File List
- `packages/api/app/services/perspective_service.py` - Created
- `packages/api/app/routers/contents.py` - Modified (added endpoint)
- `packages/api/test_perspectives.py` - Created (test script)
- `packages/api/test_keywords.py` - Created (test script)
