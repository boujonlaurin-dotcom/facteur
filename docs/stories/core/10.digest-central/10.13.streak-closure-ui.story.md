# Story 10.13 : Intégration Streak Closure dans UI

## Status: Draft

## Story

**As a** utilisateur,  
**I want** voir mon streak de closure dans l'interface,  
**so that** je sois motivé à maintenir ma série de jours consécutifs.

## Acceptance Criteria

1. **Badge streak** dans l'AppBar du DigestScreen
2. **Format** : icône flamme + nombre (ex: "4")
3. **Animation** quand le streak augmente
4. **Tooltip** au tap avec message explicatif
5. **Intégration** dans l'écran de closure (Story 10.12)

## Tasks / Subtasks

### Frontend Mobile

- [ ] **Task 1: Créer le widget `StreakBadge`**
  - [ ] Fichier `apps/mobile/lib/features/digest/widgets/streak_badge.dart`
  - [ ] Props : `streak`, `isAnimating`

- [ ] **Task 2: Intégrer dans DigestScreen**
  - [ ] Ajouter dans l'AppBar
  - [ ] Consumer pour écouter le provider

- [ ] **Task 3: Ajouter l'animation d'incrément**
  - [ ] Pulse quand le streak augmente
  - [ ] Couleur qui change selon le niveau

- [ ] **Task 4: Tooltip explicatif**
  - [ ] "X jours consécutifs de digest complété"

## Dev Notes

### Widget StreakBadge

```dart
// apps/mobile/lib/features/digest/widgets/streak_badge.dart

import 'package:flutter/material.dart';

class StreakBadge extends StatefulWidget {
  final int streak;
  final bool animate;

  const StreakBadge({
    super.key,
    required this.streak,
    this.animate = false,
  });

  @override
  State<StreakBadge> createState() => _StreakBadgeState();
}

class _StreakBadgeState extends State<StreakBadge>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<double> _scaleAnimation;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: const Duration(milliseconds: 400),
      vsync: this,
    );
    _scaleAnimation = Tween<double>(begin: 1.0, end: 1.3).animate(
      CurvedAnimation(parent: _controller, curve: Curves.elasticOut),
    );
  }

  @override
  void didUpdateWidget(StreakBadge oldWidget) {
    super.didUpdateWidget(oldWidget);
    if (widget.streak > oldWidget.streak) {
      _controller.forward().then((_) => _controller.reverse());
    }
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  Color get streakColor {
    if (widget.streak >= 30) return Colors.purple;
    if (widget.streak >= 14) return Colors.red;
    if (widget.streak >= 7) return Colors.orange;
    return Colors.grey[400]!;
  }

  @override
  Widget build(BuildContext context) {
    if (widget.streak <= 0) return const SizedBox.shrink();

    return Tooltip(
      message: '${widget.streak} jours consécutifs de digest complété',
      child: ScaleTransition(
        scale: _scaleAnimation,
        child: Container(
          padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 4),
          decoration: BoxDecoration(
            color: streakColor.withOpacity(0.2),
            borderRadius: BorderRadius.circular(12),
            border: Border.all(color: streakColor.withOpacity(0.5)),
          ),
          child: Row(
            mainAxisSize: MainAxisSize.min,
            children: [
              Icon(
                Icons.local_fire_department,
                color: streakColor,
                size: 16,
              ),
              const SizedBox(width: 4),
              Text(
                '${widget.streak}',
                style: TextStyle(
                  color: streakColor,
                  fontWeight: FontWeight.bold,
                  fontSize: 14,
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

### Intégration DigestScreen

```dart
// Dans digest_screen.dart

@override
Widget build(BuildContext context, WidgetRef ref) {
  final digestAsync = ref.watch(digestProvider);

  return Scaffold(
    appBar: AppBar(
      title: const Text('L\'Essentiel'),
      centerTitle: true,
      actions: [
        // Streak badge
        digestAsync.maybeWhen(
          data: (state) => Padding(
            padding: const EdgeInsets.only(right: 12),
            child: StreakBadge(
              streak: state.digest?.closureStreak ?? 0,
            ),
          ),
          orElse: () => const SizedBox.shrink(),
        ),
      ],
    ),
    // ...
  );
}
```

## Definition of Done

- [ ] StreakBadge créé et intégré
- [ ] Animation d'incrément fonctionnelle
- [ ] Couleurs selon niveau de streak
- [ ] Tooltip explicatif

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 31/01/2026 | 1.0 | Création story | BMad Master |
