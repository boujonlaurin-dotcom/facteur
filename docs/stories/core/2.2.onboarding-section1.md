# Story 2.2: Onboarding Section 1 "Overview"

## Status: Done

## Story

**As a** nouvel utilisateur,  
**I want** rÃ©pondre Ã  des questions sur mes grands objectifs,  
**so that** Facteur comprenne pourquoi je suis lÃ .

## Acceptance Criteria

1. âœ… 3-4 Ã©crans couvrant : objectifs avec Facteur, Ã¢ge, genre, prÃ©fÃ©rence d'approche
2. âœ… RÃ©actions engageantes aprÃ¨s chaque rÃ©ponse clÃ© expliquant la philosophie Facteur
3. âœ… UI ludique avec illustrations/animations lÃ©gÃ¨res
4. âœ… Indicateur de progression visible (section 1/3)
5. âœ… RÃ©ponses stockÃ©es localement pendant le flow

## Tasks / Subtasks

- [x] **Task 1 : Structure et navigation de l'onboarding** (AC: 4)
  - [x] CrÃ©er `OnboardingNotifier` (Riverpod) pour gÃ©rer l'Ã©tat global du flow
  - [x] ImplÃ©menter `OnboardingState` avec : currentSection, currentQuestion, answers map
  - [x] Configurer la navigation interne avec AnimatedSwitcher et animations fluides
  - [x] ImplÃ©menter l'indicateur de progression (barre animÃ©e + "Section 1/3")

- [x] **Task 2 : Ã‰cran Q1 - "Pourquoi es-tu lÃ  ?"** (AC: 1, 3)
  - [x] CrÃ©er le widget `ObjectiveQuestion`
  - [x] ImplÃ©menter 3 options sÃ©lectionnables avec emojis :
    - ğŸ“š "Apprendre de nouvelles choses"
    - ğŸŒ "Me cultiver et comprendre le monde"
    - ğŸ’¼ "Faire ma veille professionnelle"
  - [x] Ajouter emoji thÃ©matique en haut de l'Ã©cran (ğŸ‘‹)
  - [x] ImplÃ©menter le state de sÃ©lection (border terracotta #E07A5F)
  - [x] Auto-transition vers Ã©cran rÃ©action aprÃ¨s sÃ©lection

- [x] **Task 3 : Ã‰cran RÃ©action aprÃ¨s Q1** (AC: 2, 3)
  - [x] CrÃ©er le widget `ReactionScreen` rÃ©utilisable
  - [x] Afficher message personnalisÃ© selon la rÃ©ponse Q1 :
    - Apprendre â†’ "Super ! Facteur est fait pour Ã§a. On va t'aider Ã  apprendre un peu chaque jour..."
    - Cultiver â†’ "Excellent choix ! Facteur t'aide Ã  comprendre le monde sans te noyer..."
    - Veille â†’ "Parfait ! Facteur filtre le bruit pour que tu restes pertinent..."
  - [x] Animation d'apparition du texte (fade-in sÃ©quentiel avec AnimationController)
  - [x] Bouton "Continuer" avec animation d'apparition diffÃ©rÃ©e

- [x] **Task 4 : Ã‰cran Q2 - Tranche d'Ã¢ge** (AC: 1, 3)
  - [x] CrÃ©er le widget `AgeQuestion`
  - [x] ImplÃ©menter 4 options : 18-24, 25-34, 35-44, 45+
  - [x] Style `SelectionCard` cohÃ©rent avec Q1
  - [x] Stocker dans `answers.ageRange`

- [x] **Task 5 : Ã‰cran Q3 - Genre** (AC: 1, 3)
  - [x] CrÃ©er le widget `GenderQuestion`
  - [x] ImplÃ©menter options : Homme, Femme, Autre
  - [x] Marquer visuellement comme optionnel (chip "Optionnel")
  - [x] Bouton "Passer cette question" en bas
  - [x] Stocker dans `answers.gender` si rÃ©pondu

- [x] **Task 6 : Ã‰cran Q4 - PrÃ©fÃ©rence d'approche** (AC: 1, 3)
  - [x] CrÃ©er le widget `ApproachQuestion`
  - [x] Question : "Tu prÃ©fÃ¨res..."
  - [x] 2 options avec `BinarySelectionCard` :
    - âš¡ "Aller droit au but" â†’ `approach: "direct"`
    - ğŸŒ¿ "Prendre le temps d'explorer" â†’ `approach: "detailed"`
  - [x] Stocker dans `answers.approach`
  - [x] Transition vers Section 2 aprÃ¨s sÃ©lection

- [x] **Task 7 : Stockage local des rÃ©ponses** (AC: 5)
  - [x] Utiliser Riverpod StateNotifier pour stockage en mÃ©moire pendant le flow
  - [x] ImplÃ©menter persistance locale (Hive) en cas de fermeture app
  - [x] Restaurer les rÃ©ponses si l'utilisateur revient Ã  un flow interrompu
  - [x] CrÃ©er modÃ¨le `OnboardingAnswers` avec serialization JSON

- [x] **Task 8 : Animations et polish** (AC: 3)
  - [x] ImplÃ©menter animation de transition entre questions (fade + slide avec AnimatedSwitcher)
  - [x] Ajouter feedback haptic sur sÃ©lection (HapticFeedback.lightImpact)
  - [x] ImplÃ©menter animation de la barre de progression (TweenAnimationBuilder)
  - [x] Respecter les durÃ©es du front-end-spec (300ms transitions, 100ms press, 400ms progress)

## Dev Notes

### Previous Story Insights (from 2.1)
[Source: docs/stories/2.1.modele-donnees-profil.md]
- Navigation complÃ¨te avec redirect logic basÃ©e sur `onboarding_completed`
- L'Ã©cran onboarding placeholder existe dans `features/onboarding/screens/`
- La logique de redirect vÃ©rifie `authState.onboardingCompleted`
- Endpoint `POST /api/users/onboarding` prÃªt pour la sauvegarde finale (Section 3)
- Les donnÃ©es de cette section seront envoyÃ©es Ã  l'API Ã  la fin de l'onboarding complet (pas Ã  chaque question)

### Data Models (for local storage)
[Source: docs/architecture.md#4-data-models]

Les rÃ©ponses de la Section 1 correspondent Ã  :
- `age_range` â†’ Sera stockÃ© dans `user_profiles` (enum: "18-24", "25-34", "35-44", "45+")
- `gender` â†’ Sera stockÃ© dans `user_profiles` (optionnel)
- `approach` â†’ Sera stockÃ© dans `user_preferences` avec key="approach", value="direct" ou "detailed"
- `objective` â†’ Sera stockÃ© dans `user_preferences` avec key="objective", value="learn"|"culture"|"work"

### UI Specifications
[Source: docs/front-end-spec.md#4.2]

**Ã‰cran Onboarding Question Layout :**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  Section 1/3     â”‚  â† Progress bar
â”‚                                         â”‚
â”‚           [Illustration]                â”‚  â† Illustration thÃ©matique
â”‚                                         â”‚
â”‚     Question text here                  â”‚  â† Question
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“š  Option 1 text              â”‚   â”‚  â† SelectionCard
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸŒ  Option 2 text              â”‚   â”‚  â† SelectionCard
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ...                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**SelectionCard States :**
- Default: Background #1E1E1E, Border radius 12px
- Selected: Border 2px terracotta #E07A5F
- Pressed: Scale 0.98 (100ms ease-out)

### Branding & Colors
[Source: docs/front-end-spec.md#6]

| Element | Color |
|---------|-------|
| Background | #121212 |
| Cards | #1E1E1E |
| Text Primary | #F5F5F5 |
| Accent (selected) | #E07A5F (Terracotta) |
| Progress bar active | #E07A5F |
| Progress bar inactive | #252525 |

### Typography
[Source: docs/front-end-spec.md#6.3]

| Element | Font | Size | Weight |
|---------|------|------|--------|
| Question text | Fraunces | 24px | 600 |
| Option text | DM Sans | 17px | 400 |
| Section indicator | DM Sans | 13px | 400 |
| Reaction text | DM Sans | 17px | 400 |

### Animations
[Source: docs/front-end-spec.md#9]

| Animation | Duration | Easing |
|-----------|----------|--------|
| Screen Transition | 300ms | ease-in-out |
| Card Press | 100ms | ease-out |
| Card Release | 150ms | ease-out |
| Progress Bar Fill | 400ms | ease-out |
| Reaction Text Fade | 200ms | ease-out |

### File Locations
[Source: docs/architecture.md#11]

```
apps/mobile/lib/
â”œâ”€â”€ features/
â”‚   â””â”€â”€ onboarding/
â”‚       â”œâ”€â”€ screens/
â”‚       â”‚   â”œâ”€â”€ onboarding_screen.dart          # Main container
â”‚       â”‚   â””â”€â”€ questions/
â”‚       â”‚       â”œâ”€â”€ objective_question.dart     # Q1
â”‚       â”‚       â”œâ”€â”€ age_question.dart           # Q2
â”‚       â”‚       â”œâ”€â”€ gender_question.dart        # Q3
â”‚       â”‚       â””â”€â”€ approach_question.dart      # Q4
â”‚       â”œâ”€â”€ widgets/
â”‚       â”‚   â”œâ”€â”€ selection_card.dart             # SelectionCard + BinarySelectionCard
â”‚       â”‚   â”œâ”€â”€ onboarding_progress_bar.dart    # Barre de progression
â”‚       â”‚   â””â”€â”€ reaction_screen.dart            # Ã‰cran rÃ©action
â”‚       â””â”€â”€ providers/
â”‚           â””â”€â”€ onboarding_provider.dart        # Riverpod state
```

### Questions Content (Section 1)
[Source: docs/front-end-spec.md#3.1]

| # | Question | Options | Stores |
|---|----------|---------|--------|
| Q1 | "Pourquoi es-tu lÃ  ?" | Apprendre / Me cultiver / Veille pro | `objective` |
| R1 | RÃ©action personnalisÃ©e | â€” | â€” |
| Q2 | "Quelle est ta tranche d'Ã¢ge ?" | 18-24 / 25-34 / 35-44 / 45+ | `age_range` |
| Q3 | "Tu es..." (optionnel) | Homme / Femme / Autre / PrÃ©fÃ¨re ne pas rÃ©pondre | `gender` |
| Q4 | "Tu prÃ©fÃ¨res..." | Aller droit au but / Prendre le temps | `approach` |

## Testing

### Test Standards
[Source: docs/architecture.md#15]

- Tests dans `apps/mobile/test/features/onboarding/`
- Framework : `flutter_test`
- Convention : `<widget>_test.dart`

### Test Cases

1. **test_onboarding_progress_indicator** : VÃ©rifier que la barre progresse correctement (4 Ã©tapes Section 1)
2. **test_objective_question_selection** : VÃ©rifier qu'une seule option peut Ãªtre sÃ©lectionnÃ©e
3. **test_reaction_screen_content** : VÃ©rifier que le message correspond Ã  la rÃ©ponse sÃ©lectionnÃ©e
4. **test_age_question_selection** : VÃ©rifier le stockage correct de age_range
5. **test_gender_question_skip** : VÃ©rifier que la question peut Ãªtre passÃ©e
6. **test_approach_question_transition** : VÃ©rifier la transition vers Section 2
7. **test_answers_persistence** : VÃ©rifier que les rÃ©ponses sont restaurÃ©es aprÃ¨s fermeture app
8. **test_selection_card_states** : VÃ©rifier les Ã©tats visuels (default, selected, pressed)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 07/01/2026 | 1.0 | Story crÃ©Ã©e via create-next-story task | BMad Master |
| 07/01/2026 | 1.1 | ImplÃ©mentation complÃ¨te Section 1 | Claude (Opus 4) |

## Dev Agent Record

### Agent Model Used
Claude (Opus 4)

### Debug Log References
N/A

### Completion Notes
ImplÃ©mentation complÃ¨te de la Section 1 "Overview" de l'onboarding avec :
- Architecture Riverpod complÃ¨te avec `OnboardingNotifier` et `OnboardingState`
- Persistence locale via Hive pour reprendre un flow interrompu
- 4 Ã©crans de questions + 1 Ã©cran de rÃ©action personnalisÃ©e
- Widgets rÃ©utilisables : `SelectionCard`, `BinarySelectionCard`, `OnboardingProgressBar`, `ReactionScreen`
- Animations fluides (300ms transitions, feedback haptic, progress bar animÃ©e)
- Respect du design system Facteur (couleurs, typo, spacing)

**Note importante :** La transition vers Section 2 complÃ¨te actuellement l'onboarding et redirige vers le Feed car les stories 2.2b/c/d ne sont pas encore implÃ©mentÃ©es.

### File List

**CrÃ©Ã©s :**
- `apps/mobile/lib/features/onboarding/providers/onboarding_provider.dart`
- `apps/mobile/lib/features/onboarding/widgets/selection_card.dart`
- `apps/mobile/lib/features/onboarding/widgets/onboarding_progress_bar.dart`
- `apps/mobile/lib/features/onboarding/widgets/reaction_screen.dart`
- `apps/mobile/lib/features/onboarding/screens/questions/objective_question.dart`
- `apps/mobile/lib/features/onboarding/screens/questions/age_question.dart`
- `apps/mobile/lib/features/onboarding/screens/questions/gender_question.dart`
- `apps/mobile/lib/features/onboarding/screens/questions/approach_question.dart`

**ModifiÃ©s :**
- `apps/mobile/lib/features/onboarding/screens/onboarding_screen.dart` (refactorisÃ© pour utiliser les nouveaux composants)
