# Story 7.1: Profiling éditorial des sources

## Status
Done

## Story
**As a** développeur,
**I want** enrichir le modèle des sources avec des données de positionnement éditorial,
**so that** le système puisse qualifier la perspective de chaque contenu.

## Acceptance Criteria
12. ✅ Table `sources` enrichie : `bias_stance` (Left, Center, Right, etc.) et `reliability_score`.
13. ✅ Script d'import mis à jour pour intégrer ces données depuis un mapping statique/JSON.
14. ✅ Gestion des sources sans données (cas par défaut: `UNKNOWN`) côtés back et front.
15. ✅ Pas d'utilisation de LLM pour cette phase (données GN ou curation manuelle uniquement).
16. **Indice FQS** : Le `reliability_score` est désormais objectivé par le **Facteur Quality Score (FQS)** (Indépendance, Rigueur, UX). Chacun noté de 0.0 à 1.0.

## Tasks / Subtasks
- [x] Database Schema Update (AC: 12)
  - [x] Add `bias_stance` column to `sources` table
  - [x] Add `reliability_score` column to `sources` table
  - [x] Add `bias_origin` column to `sources` table
- [ ] **Database Schema Update (FQS Granular)** (AC: 16)
  - [ ] Add `score_independence`, `score_rigor`, `score_ux` columns to `sources` table
- [x] Model & Enum Updates (AC: 12)
  - [x] Create `BiasStance`, `ReliabilityScore`, `BiasOrigin` enums in `enums.py`
  - [x] Update `Source` SQLAlchemy model
- [x] Data Enrichment (AC: 13)
  - [x] Enrich `sources/sources.csv` with bias labels for the 24 curated sources
  - [x] Update import script (Python) to read and save these new fields
- [ ] **Data Enrichment (FQS Granular)** (AC: 16)
  - [ ] Update import script to generate/map scores based on `ReliabilityScore` (Heuristics V1)
- [x] Frontend Handling (AC: 14)
  - [x] Update `SourceMini` schema to include bias info
  - [x] Handle null/unknown values in Flutter models
- [ ] **Frontend Handling (FQS Detail)** (AC: 16)
  - [ ] Update `Source` Flutter model with the 3 granular scores
  - [ ] Connect `SourceDetailModal` to these backend values

## Dev Notes
- Sources mappées manuellement dans le CSV avec colonnes `Bias` et `Reliability`
- Migration Alembic: `4d7188dfeefd_add_bias_and_reliability_to_source_v2.py`
- 22/27 sources profilées avec bias et reliability

## Testing
- [x] Unit test: Verify source import saves bias correctly
- [x] Smoke test: Check the API response for curated sources

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 11/01/2026 | 1.0 | Création initiale | BMad Method |
| 11/01/2026 | 1.1 | Implémentation complète | Dev Agent |

## Dev Agent Record

### Agent Model Used
Antigravity (Google Deepmind)

### Completion Notes List
- Added 3 enums: BiasStance, ReliabilityScore, BiasOrigin
- Created Alembic migration for new columns
- Updated import_sources.py to handle new CSV columns
- Updated SourceMini schema for API response
- All 22 curated sources now have bias/reliability data

### File List
- `packages/api/app/models/enums.py` - Modified (added enums)
- `packages/api/app/models/source.py` - Modified (added columns)
- `packages/api/app/schemas/content.py` - Modified (SourceMini)
- `packages/api/scripts/import_sources.py` - Modified
- `sources/sources.csv` - Modified (added Bias, Reliability columns)
- `packages/api/alembic/versions/4d7188dfeefd_*.py` - Created
