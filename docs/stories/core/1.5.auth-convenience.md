# Story 1.5: Auth Convenience Features

**Status:** Draft

## Story

**As a** utilisateur,
**I want** rester connecté entre les sessions et pouvoir réinitialiser mon mot de passe en cas d'oubli,
**so that** naviguer plus rapidement sans me reconnecter à chaque fois et ne pas perdre l'accès à mon compte.

## Acceptance Criteria

1. Une checkbox "Rester connecté" est ajoutée à l'écran de Login. (AC: 1.3/2)
2. La préférence de persistence est respectée : si décochée, la session est effacée lors de la fermeture de l'app (comportement non-persistant). (AC: 1.3/5)
3. Un lien "Mot de passe oublié ?" est ajouté sous le champ mot de passe. (AC: 1.3/2)
4. Tap sur "Mot de passe oublié ?" ouvre une boîte de dialogue pour saisir l'email de récupération.
5. L'envoi de l'email de réinitialisation est déclenché via `supabase.auth.resetPasswordForEmail()`.
6. Un message de confirmation ou d'erreur est affiché à l'utilisateur après la tentative d'envoi.

## Tasks / Subtasks

- [ ] UI: Update Login Screen <!-- id: 1 -->
    - [ ] Add `CheckboxListTile` for "Rester connecté" <!-- id: 2 -->
    - [ ] Add `TextButton` for "Mot de passe oublié ?" <!-- id: 3 -->
- [ ] Business Logic: Update AuthStateNotifier <!-- id: 4 -->
    - [ ] Add `resetPassword(String email)` method <!-- id: 5 -->
    - [ ] Handle persistence preference during `signInWithEmail` <!-- id: 6 -->
- [ ] Verification <!-- id: 7 -->
    - [ ] Test password reset flow with a real email <!-- id: 8 -->
    - [ ] Test session persistence by restarting the app <!-- id: 9 -->

## V0 Auth Cleanup
- [ ] Remove Google/Apple login buttons from Login Screen (temporarily for V0) <!-- id: 10 -->
- [ ] Remove "Or continue with" divider <!-- id: 11 -->

## Dev Notes

### Previous Story Insights
- Story 1.3 setup the basic authentication.
- Story 1.4 handled redirection based on auth state.
- Bug fix (previous task) ensured redirection to onboarding for authenticated users.

### API Specifications
- [Source: Supabase Auth Documentation]
    - `supabase.auth.resetPasswordForEmail(email, {redirectTo})`
    - Session persistence is handled by `Supabase.initialize(authOptions: FlutterAuthClientOptions(localStorage: ...))` or by manually signing out if persistence was not desired.

### File Locations
- [Login Screen](file:///Users/laurinboujon/Desktop/Projects/Work Projects/Facteur/apps/mobile/lib/features/auth/screens/login_screen.dart)
- [Auth State](file:///Users/laurinboujon/Desktop/Projects/Work Projects/Facteur/apps/mobile/lib/core/auth/auth_state.dart)

## Testing
- Test file: `test/auth_convenience_test.dart` (to be created)
- Framework: `flutter_test` with `riverpod_test`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 10/01/2026 | 1.0 | Création initiale | BMad Master |
