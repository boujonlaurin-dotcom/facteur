# Story 5.4: Syst√®me de Streak quotidien

## Status: Ready

## Story

**As a** utilisateur,  
**I want** voir mon streak de jours cons√©cutifs,  
**so that** je sois motiv√© √† revenir chaque jour.

## Acceptance Criteria

1. Table `user_streaks` ou extension `user_profiles` pour stocker le streak actuel et le max streak. [Source: prd.md#Story 5.4]
2. **Logique de Validation**: Un jour est valid√© si au moins un contenu est consomm√© (`CONSUMED`, cf Story 5.3).
3. **Incr√©mentation**:
   - Si jour J consomm√© ET jour J-1 consomm√© ‚Üí Streak + 1.
   - Si jour J consomm√© ET jour J-1 non consomm√© ‚Üí Streak = 1.
   - Si jour J non consomm√© ‚Üí Streak inchang√© (affichage J-1 si n√©cessaire, mais reset logique au prochain appel si > 24h + window).
4. **Affichage**:
   - Ic√¥ne flamme üî• + Nombre de jours.
   - Visible sur l'√©cran Feed (header) et/ou Progression.
5. **Animation**: Petite animation de c√©l√©bration lors de l'incr√©mentation (optionnel MVP).
6. **Notification**: (Optionnel MVP) Notification push si le streak est en danger (fin de journ√©e).

## Tasks / Subtasks

- [x] **Task 1: Backend - Streak Logic**
  - [x] Mettre √† jour `user_profiles` ou cr√©er table `user_streaks` (user_id, current_streak, last_consumption_date, max_streak).
  - [x] Mettre √† jour le service qui g√®re `POST /api/contents/{id}/status` (Story 5.3) pour v√©rifier et mettre √† jour le streak.
  - [x] Impl√©menter la logique de calcul (comparer dates).
  - [x] Exposer info streak dans `GET /api/user/me` ou endpoint d√©di√©.

- [x] **Task 2: Frontend - Streak Components**
  - [x] Cr√©er `StreakModel` si n√©cessaire (ou champ dans User).
  - [x] Ajouter `streak` au `UserNotifier` / `UserProfile` (Implemented via `StreakProvider`).
  - [x] Cr√©er widget `StreakIndicator` (Icone Flamme + Compteur).
  - [x] Int√©grer dans `FeedScreen` (AppBar).

- [ ] **Task 3: Tests & Validation**
  - [ ] Test unitaire backend: sc√©narios incr√©mentation, reset (boucle sur plusieurs jours simul√©s).
  - [ ] Test widget: affichage correct.

## Dev Notes

### Streak Logic Detail
- Utiliser la date du serveur pour √©viter la triche.
- Simplification MVP : UTC pour les jours.
- Le streak n'est mis √† jour que lors d'une action de consommation. Si l'utilisateur ne vient pas pendant 3 jours, le streak reste √† X en base, mais d√®s qu'il revient et consomme, le calcul voit `last_date` < `today - 1` donc Reset √† 1.

### Relation with Story 5.3
- Story 5.3 marque le contenu comme `CONSUMED`.
- C'est le trigger pour le calcul.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 11/01/2026 | 1.0 | Initial Draft | BMad Agent |
