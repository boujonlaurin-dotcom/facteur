---
phase: 02-frontend
plan: 13
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/mobile/lib/features/digest/screens/digest_screen.dart
  - apps/mobile/lib/features/digest/widgets/not_interested_confirmation_sheet.dart
autonomous: true
must_haves:
  truths:
    - "Tapping 'moins voir...' shows confirmation sheet with explanation"
    - "Confirmation sheet has 'Confirmer' and 'Annuler' buttons"
    - "Tapping 'Confirmer' applies the not_interested action"
    - "Article is dimmed after confirmation"
  artifacts:
    - path: "apps/mobile/lib/features/digest/widgets/not_interested_confirmation_sheet.dart"
      provides: "Confirmation sheet UI for Not Interested action"
    - path: "apps/mobile/lib/features/digest/screens/digest_screen.dart"
      provides: "Updated _handleNotInterested to show confirmation first"
  key_links:
    - from: "digest_screen.dart _handleNotInterested"
      to: "NotInterestedConfirmationSheet"
      pattern: "showModalBottomSheet with NotInterestedConfirmationSheet"
    - from: "NotInterestedConfirmationSheet onConfirm"
      to: "digestProvider.notifier.applyAction"
      pattern: "ref.read(digestProvider.notifier).applyAction(contentId, 'not_interested')"
---

<objective>
Fix the "Not Interested" action to show a proper confirmation sheet instead of the "Pourquoi cet article?" sheet.

Purpose: Users currently see "Information non disponible" when tapping "moins voir..." because the wrong sheet is opened. This creates confusion and poor UX.
Output: New NotInterestedConfirmationSheet widget and updated handler flow.
</objective>

<execution_context>
@/Users/laurinboujon/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/02-frontend/02-12-UAT.md
@apps/mobile/lib/features/digest/screens/digest_screen.dart
@apps/mobile/lib/features/digest/widgets/digest_personalization_sheet.dart
</context>

<tasks>

<task type="auto">
  <name>Create NotInterestedConfirmationSheet widget</name>
  <files>apps/mobile/lib/features/digest/widgets/not_interested_confirmation_sheet.dart</files>
  <action>
    Create a new bottom sheet widget for confirming "Not Interested" action.
    
    Design requirements:
    - Title: "Masquer cet article ?"
    - Icon: PhosphorIcons.eyeSlash (warning/alert color)
    - Explanation text: "Cela masquera cet article et r√©duira les contenus similaires de cette source."
    - Source name displayed prominently
    - Two buttons at bottom:
      - "Annuler" (secondary/cancel style)
      - "Confirmer" (primary/destructive style - orange/red tint)
    
    Parameters:
    - String sourceName
    - VoidCallback onConfirm
    - VoidCallback onCancel
    
    Use the same visual style as other bottom sheets in the app (drag handle, padding, border radius).
  </action>
  <verify>flutter analyze passes with 0 errors</verify>
  <done>Widget created with proper styling and callbacks</done>
</task>

<task type="auto">
  <name>Update _handleNotInterested to show confirmation first</name>
  <files>apps/mobile/lib/features/digest/screens/digest_screen.dart</files>
  <action>
    Modify the _handleNotInterested method to:
    1. Show NotInterestedConfirmationSheet
    2. Only apply the action when user confirms
    3. After confirmation, optionally show DigestPersonalizationSheet for additional muting options
    
    New flow:
    ```
    void _handleNotInterested(DigestItem item) {
      HapticFeedback.lightImpact();
      
      // Show confirmation sheet first
      showModalBottomSheet<void>(
        context: context,
        backgroundColor: Colors.transparent,
        isScrollControlled: true,
        builder: (_) => NotInterestedConfirmationSheet(
          sourceName: item.source?.name ?? 'cette source',
          onConfirm: () {
            Navigator.pop(context);
            // Apply the action
            ref.read(digestProvider.notifier).applyAction(
              item.contentId, 
              'not_interested',
            );
            // Optionally show personalization sheet for more options
            _showPersonalizationSheet(item);
          },
          onCancel: () => Navigator.pop(context),
        ),
      );
    }
    ```
    
    Also add a helper method _showPersonalizationSheet that shows the DigestPersonalizationSheet for muting options.
  </action>
  <verify>flutter analyze passes with 0 errors</verify>
  <done>_handleNotInterested shows confirmation sheet and only applies action on confirm</done>
</task>

</tasks>

<verification>
- NotInterestedConfirmationSheet created with proper UI
- _handleNotInterested updated to show confirmation first
- Action only applied after user confirms
- flutter analyze passes with 0 errors
</verification>

<success_criteria>
- Tapping "moins voir..." shows confirmation sheet with explanation
- Sheet has "Confirmer" and "Annuler" buttons
- Tapping "Confirmer" dismisses sheet and marks article as not interested
- Article card dims after confirmation
- No "Information non disponible" message appears
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend/02-13-SUMMARY.md`
</output>
