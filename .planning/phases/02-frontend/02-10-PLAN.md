---
phase: 02-frontend
plan: 10
type: execute
wave: 1
depends_on: []
files_modified: [packages/api/requirements.txt, packages/api/pyproject.toml]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "greenlet>=3.0.0 is installed and available for SQLAlchemy async operations"
    - "SQLAlchemy can switch async contexts without MissingGreenlet error"
  artifacts:
    - path: "packages/api/requirements.txt"
      provides: "greenlet dependency"
      contains: "greenlet>=3.0.0"
    - path: "packages/api/pyproject.toml"
      provides: "greenlet in project dependencies"
      contains: "greenlet"
  key_links:
    - from: "SQLAlchemy async session"
      to: "greenlet async context switching"
      via: "pip dependency"
---

<objective>
Add missing greenlet>=3.0.0 dependency required by SQLAlchemy for async context switching.

Purpose: SQLAlchemy async operations require greenlet for context switching. Missing dependency causes MissingGreenlet errors in async database operations.
Output: Both requirements.txt and pyproject.toml updated with greenlet>=3.0.0.
</objective>

<execution_context>
@/Users/laurinboujon/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/laurinboujon/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-frontend/02-frontend-UAT.md
@packages/api/requirements.txt
</context>

<tasks>

<task type="auto">
  <name>Add greenlet dependency to requirements.txt</name>
  <files>packages/api/requirements.txt</files>
  <action>
    Add greenlet>=3.0.0 to packages/api/requirements.txt in the Database section:

    Add below line 11 (after sqlalchemy[asyncio]==2.0.25):
    greenlet>=3.0.0

    The Database section should look like:
    # Database
    sqlalchemy[asyncio]==2.0.25
    greenlet>=3.0.0
    psycopg[binary,pool]>=3.2.0
    alembic==1.13.1

    This is required by SQLAlchemy for async context switching.
  </action>
  <verify>
    grep "^greenlet" packages/api/requirements.txt
  </verify>
  <done>
    - greenlet>=3.0.0 added to requirements.txt
    - Located in Database dependencies section
  </done>
</task>

<task type="auto">
  <name>Add greenlet dependency to pyproject.toml</name>
  <files>packages/api/pyproject.toml</files>
  <action>
    Add greenlet>=3.0.0 to packages/api/pyproject.toml in the dependencies array.

    Find the [project] section and add "greenlet>=3.0.0" to the dependencies list,
    near other database dependencies like sqlalchemy.

    If pyproject.toml doesn't exist or doesn't have a dependencies section,
    check if the project uses it at all. Many Python projects only use requirements.txt.
    Only add to pyproject.toml if it already exists and has dependencies configured.
  </action>
  <verify>
    grep -i "greenlet" packages/api/pyproject.toml 2>/dev/null || echo "pyproject.toml not found or no greenlet entry (OK if only using requirements.txt)"
  </verify>
  <done>
    - greenlet>=3.0.0 added to pyproject.toml dependencies (if file exists with deps section)
    - Or confirmed project only uses requirements.txt
  </done>
</task>

</tasks>

<verification>
- [ ] requirements.txt contains greenlet>=3.0.0
- [ ] pyproject.toml updated (if applicable)
- [ ] Dependency placed in correct section (Database)
</verification>

<success_criteria>
- greenlet>=3.0.0 listed in requirements.txt
- SQLAlchemy async operations can switch contexts without MissingGreenlet error
- pip install -r requirements.txt installs greenlet successfully
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend/02-10-SUMMARY.md`
</output>
