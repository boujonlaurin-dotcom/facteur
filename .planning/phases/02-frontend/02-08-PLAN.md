---
phase: 02-frontend
plan: 08
type: execute
wave: 2
depends_on: ["02-07"]
files_modified:
  - apps/mobile/lib/features/feed/screens/feed_screen.dart
  - apps/mobile/lib/features/feed/widgets/briefing_section.dart
  - apps/mobile/lib/features/feed/repositories/feed_repository.dart
  - packages/api/app/api/routes/feed.py
autonomous: true

must_haves:
  truths:
    - "Old BriefingSection removed from FeedScreen"
    - "Feed no longer displays 'L'Essentiel du Jour' section"
    - "Feed API no longer returns briefing data"
    - "Old code marked as deprecated"
    - "New Digest system fully functional and validated"
  artifacts:
    - path: "apps/mobile/lib/features/feed/screens/feed_screen.dart"
      provides: "Feed without BriefingSection"
      change: "Removed BriefingSection import and usage"
    - path: "apps/mobile/lib/features/feed/widgets/briefing_section.dart"
      provides: "Deprecated BriefingSection widget"
      change: "Added @deprecated annotation"
  key_links:
    - from: "feed_screen.dart"
      to: "digest_screen.dart"
      via: "Bottom navigation - user switches to Digest for 'Essentiel'"
      pattern: "ShellScaffold tab switching"
---

<objective>
Decommission the old BriefingSection (3-article digest) from the Feed once the new DigestBriefingSection (5-article) is validated and fully functional.

Purpose: Complete the migration to the new digest-first architecture by removing the duplicate "L'Essentiel du Jour" section from the Feed, consolidating the digest experience in the dedicated Digest tab.

Output: Clean FeedScreen without BriefingSection, deprecated old code, and API no longer returning briefing data.
</objective>

<execution_context>
@/Users/laurinboujon/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/laurinboujon/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-frontend/02-07-SUMMARY.md

## Prerequisites (Must be Complete)

### Plan 02-07 Must Be Verified
- DigestBriefingSection working in DigestScreen
- 5 articles displaying correctly
- Save/NotInterested actions functional
- Progress bar integrated
- No "Read" button (automatic on tap)
- User testing confirms new digest is better

### Validation Period
Allow 1-2 weeks of production use to ensure:
- No critical bugs in new digest
- User acceptance of new location (Digest tab vs Feed)
- Closure screen and streak updates working
- No data loss or synchronization issues

## Decommission Scope

### Files to Modify
1. **FeedScreen** - Remove BriefingSection usage
2. **BriefingSection widget** - Mark as deprecated
3. **FeedRepository** - Remove briefing from API response parsing
4. **Feed API (Backend)** - Optionally stop including briefing in response

### What Stays
- BriefingSection code (marked deprecated, not deleted yet)
- DailyTop3Item model (may be needed for history)
- Briefing-related database tables (until data migration confirmed)

### User Impact
- Users will no longer see "L'Essentiel du Jour" in Feed
- They must go to "Essentiel" tab for digest
- This is intentional - reinforces digest-first architecture
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove BriefingSection from FeedScreen</name>
  <files>apps/mobile/lib/features/feed/screens/feed_screen.dart</files>
  <action>
Remove the BriefingSection from FeedScreen:

1. Find and remove import:
   ```dart
   // Remove this line:
   import '../widgets/briefing_section.dart';
   ```

2. Find BriefingSection usage in build method (around line 320-330):
   ```dart
   // Remove this block:
   if (briefing.isNotEmpty) {
     return BriefingSection(
       briefing: briefing,
       onItemTap: (item) => _showArticleModal(item.content),
       onPersonalize: (item) => _showPersonalizationSheet(context, item.content),
     );
   }
   ```

3. Update the SliverList itemBuilder to remove briefing handling:
   ```dart
   // Current structure may be:
   itemBuilder: (context, index) {
     if (index == 0 && briefing.isNotEmpty) {
       return BriefingSection(...);
     }
     // ... rest of items
   }
   
   // Change to simple list without briefing:
   itemBuilder: (context, index) {
     final content = contents[index];
     return FeedCard(...);
   }
   ```

4. If there's a special case for index 0 with briefing, simplify the logic

5. Remove briefing from FeedState if no longer needed (or keep for now):
   - Check if briefing field is used elsewhere
   - If only in FeedScreen, can remove
   - Otherwise, keep but don't display

6. Verify no references to briefing variable remain in FeedScreen
  </action>
  <verify>FeedScreen compiles without BriefingSection, feed displays only regular articles</verify>
  <done>BriefingSection removed from FeedScreen, feed shows only regular content cards</done>
</task>

<task type="auto">
  <name>Task 2: Mark BriefingSection as deprecated</name>
  <files>apps/mobile/lib/features/feed/widgets/briefing_section.dart</files>
  <action>
Mark BriefingSection as deprecated:

1. Add @deprecated annotation to the class:
   ```dart
   /// Displays a daily briefing of top 3 articles.
   /// 
   /// @deprecated Use [DigestBriefingSection] from features/digest instead.
   /// The briefing functionality has been moved to the dedicated Digest tab
   /// with 5 articles instead of 3.
   @deprecated
   class BriefingSection extends StatelessWidget {
     // ... existing code
   }
   ```

2. Add deprecation notice in constructor:
   ```dart
   @deprecated
   const BriefingSection({
     super.key,
     required this.briefing,
     required this.onItemTap,
     this.onPersonalize,
   });
   ```

3. Consider adding a runtime warning (optional):
   ```dart
   @override
   Widget build(BuildContext context) {
     assert(
       false,
       'BriefingSection is deprecated. Use DigestBriefingSection from features/digest.',
     );
     // ... rest of build
   }
   ```

4. Update any documentation comments to reflect deprecation

5. Do NOT delete the file yet - keep for reference until fully migrated
  </action>
  <verify>BriefingSection marked with @deprecated, IDE shows warnings when used</verify>
  <done>BriefingSection marked as deprecated with clear migration path to DigestBriefingSection</done>
</task>

<task type="auto">
  <name>Task 3: Remove briefing from FeedRepository response parsing</name>
  <files>apps/mobile/lib/features/feed/repositories/feed_repository.dart</files>
  <action>
Remove briefing from API response parsing in FeedRepository:

1. Find the method that parses feed response (likely `getFeed` or similar)

2. Look for briefing parsing code:
   ```dart
   // Find and remove:
   final briefingRaw = data['briefing'];
   if (briefingRaw is List) {
     for (final e in briefingRaw) {
       try {
         briefingList.add(DailyTop3Item.fromJson(e));
       } catch (err) {
         print('FeedRepository: Skipping corrupt item in briefing: $err');
       }
     }
   }
   ```

3. Remove briefing from return object:
   ```dart
   // Change from:
   return FeedResponse(
     items: itemList,
     briefing: briefingList,  // Remove this
     hasMore: hasMore,
   );
   
   // To:
   return FeedResponse(
     items: itemList,
     hasMore: hasMore,
   );
   ```

4. Remove briefingList variable declaration

5. If FeedResponse model requires briefing, make it optional or remove:
   ```dart
   // In FeedResponse class, either:
   final List<DailyTop3Item> briefing; // Make optional
   
   // Or remove entirely and update all usages
   ```

6. Keep the DailyTop3Item import for now (may be used elsewhere)
  </action>
  <verify>FeedRepository no longer parses briefing from API response</verify>
  <done>FeedRepository updated to not parse or return briefing data</done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 4: Validate new digest before finalizing decommission</name>
  <what-built>
Removed old BriefingSection from Feed and marked it deprecated. Feed now shows only regular articles.
  </what-built>
  <how-to-verify>
**CRITICAL: Do not complete this checkpoint until new digest has been validated in production.**

Before approving decommission, verify:

1. **New Digest is Working:**
   - Open app, go to "Essentiel" tab
   - Confirm 5 articles display in BriefingSection-style container
   - Test Save button (bookmark icon)
   - Test Not Interested button (opens PersonalizationSheet)
   - Tap article → should mark as read + open detail
   - Complete all 5 → closure screen appears

2. **Old BriefingSection Removed:**
   - Go to "Explorer" tab (Feed)
   - Confirm NO "L'Essentiel du Jour" section at top
   - Feed should start directly with regular articles

3. **No Regressions:**
   - Feed scrolls normally
   - Feed cards display correctly
   - Personalization works on feed articles
   - Navigation between tabs works

4. **User Acceptance:**
   - New digest location is intuitive
   - No user complaints about missing briefing in feed
   - Completion streak updates correctly

**Run these commands to verify:**
```bash
cd apps/mobile
flutter analyze
flutter test
```
  </how-to-verify>
  <resume-signal>Type "approved" when new digest is validated and ready for full decommission</resume-signal>
</task>

<task type="auto">
  <name>Task 5: Clean up FeedState model (optional)</name>
  <files>apps/mobile/lib/features/feed/models/content_model.dart</files>
  <action>
If briefing is no longer used anywhere, clean up FeedState:

1. Open `apps/mobile/lib/features/feed/models/content_model.dart`

2. Find FeedState or FeedResponse class

3. Remove briefing field:
   ```dart
   // Remove:
   final List<DailyTop3Item> briefing;
   
   // And from constructor:
   required this.briefing,
   // or
   this.briefing = const [],
   ```

4. Update copyWith method if exists

5. Update fromJson/toJson if briefing was serialized

6. Check for any other references to briefing in this file

**Note:** Only do this if you're CERTAIN briefing is not used elsewhere. If unsure, keep the field but make it optional with default empty list.
  </action>
  <verify>FeedState no longer requires briefing field, all usages updated</verify>
  <done>FeedState cleaned up, briefing field removed from model</done>
</task>

<task type="auto">
  <name>Task 6: Update backend to stop including briefing (optional)</name>
  <files>packages/api/app/api/routes/feed.py</files>
  <action>
Optionally update backend to stop including briefing in feed response:

1. Open `packages/api/app/api/routes/feed.py`

2. Find the feed endpoint (GET /api/feed)

3. Look for briefing in response:
   ```python
   return {
       "items": [item.to_dict() for item in items],
       "briefing": [item.to_dict() for item in briefing],  # Remove
       "has_more": has_more,
   }
   ```

4. Remove briefing from response

5. Remove briefing generation logic if it exists in this endpoint

6. Update any response models/schemas

**Note:** This is optional. Backend can keep sending briefing (mobile just ignores it), or you can clean it up now. Cleaning up reduces payload size and clarifies API contract.
  </action>
  <verify>Backend feed endpoint no longer includes briefing in response</verify>
  <done>Backend API cleaned up, briefing removed from feed response</done>
</task>

</tasks>

<verification>
1. **Visual verification:**
   - FeedScreen shows only regular FeedCards
   - No "L'Essentiel du Jour" section at top
   - BriefingSection shows deprecation warnings in IDE

2. **Functional verification:**
   - Feed loads normally
   - Scroll works without issues
   - Personalization works on feed articles
   - Navigation between tabs works

3. **Code verification:**
   - flutter analyze passes
   - BriefingSection marked @deprecated
   - No compilation errors
   - FeedRepository doesn't parse briefing

4. **API verification (if backend changed):**
   - GET /api/feed no longer returns briefing field
   - Response payload smaller
   - Mobile app works with new response
</verification>

<success_criteria>
- BriefingSection removed from FeedScreen
- BriefingSection marked as @deprecated
- Feed displays only regular articles (no briefing)
- FeedRepository doesn't parse briefing from API
- flutter analyze passes with 0 errors
- New Digest system remains fully functional
- Users naturally navigate to Essentiel tab for digest
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend/02-08-SUMMARY.md`

Update STATE.md to mark Phase 2 as fully complete with all UI/UX adjustments.
</output>
